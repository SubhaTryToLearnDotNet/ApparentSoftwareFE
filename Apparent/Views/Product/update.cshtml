@model ViewModel
@{

    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .video-upload {
        width: 300px;
        height: 175px;
        padding: 0.25rem;
        border-radius: 10px;
        overflow: hidden;
    }


    .video-child {
        display: inline-block;
    }
    .image-preview {
        position: relative;
        display: inline-block;
        margin-right: 10px;
    }

    .cancel-icon {
        position: absolute;
        top: 5px;
        right: 5px;
        cursor: pointer;
        color: #fff;
        font-size: 16px;
        background-color: rgba(0, 0, 0, 0.7);
        padding: 6px;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        text-align: center;
    }
</style>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }

    .loader-wrapper {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.9); /* Semi-transparent white background */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999; /* Make sure the loader is on top of everything else */
        opacity: 0; /* Initially hidden */
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .loader {
        border: 8px solid #f3f3f3; /* Light grey */
        border-top: 8px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite; /* Rotate spinner indefinitely */
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Show loader when the class 'loading' is added to the body */
    body.loading .loader-wrapper {
        opacity: 1;
        visibility: visible;
    }
</style>
<!-- Loader wrapper -->
<div class="loader-wrapper">
    <!-- Loader spinner -->
    <div class="loader"></div>
</div>


<div class="container">
    <div class="row text-center">
        <div class="loader_box" id="loder01">
            <div class="d-flex justify-content-center align-items-center ">
                <div class="loader-content">
                    <div class="loader_title">Please Wait</div>
                    <div class="loader--spinner">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="banner" style="background-position: 0px 350px;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-5 col-md-6 col-12 order-2 order-md-1">
                <h1 class="heading01">Welcome!</h1>
                <p class="paragraph banner_para">You are just a few steps away, Please fill out the required information fields to start selling</p>
                <p class="paragraph small_para"></p>
            </div>
            <!-- // -->
            <div class="col-lg-7 col-md-6 col-12 order-1 order-md-2">
                <img src="~/Content/Web/images/seller_banner03.png" alt="" />
            </div>
        </div>
        <div class="features_row upload_software">
            <form id="" method="post" action="" enctype="multipart/form-data">
                <div class="row">
                    <div class="col-lg-12">

                        <div class="row">
                            <div class="col-lg-12">
                                <ul class="progressbar">
                                    <li>Product Details</li>
                                    <li>Features</li>
                                    <li>Pricing/Packages</li>
                                </ul>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <label>Product Name <span style="color:#ed2323 ">*</span></label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="Product" value="@Model.productMaster.ProductName" name="ProductName" id="ProductName" />
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <label>Select A Category <span style="color:#ed2323 ">*</span></label>
                                <div class="ding">
                                    <select name="Category" id="Category" multiple>
                                        @foreach (var category in Model.productMaster.Category_list)
                                        {
                                            <option value="@(category)">@category</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-12">
                                <h6>Product Logo <span style="color:#ed2323 ">*</span></h6>
                                <div class="drop-zone">
                                    <span class="drop-zone__prompt">
                                        <img id="IdImg" src="@Model.productMaster.ProductIcon" alt="" /> <br />
                                        Upload Logo
                                    </span>
                                    <input type="file" name="ProductImage" value="" id="ProductImage" accept="image/png, image/gif, image/jpeg" class="drop-zone__input" />
                                </div>
                            </div>
                        </div>
                        <!-- // -->
                        <h3>Product/Software Details</h3>
                        <h6>Overview</h6>
                        <!-- // -->
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-12">

                                <label class="software_label">What is Your Software? <span style="color:#ed2323 ">*</span></label>
                                <textarea class="field01 field03 rounded-0 mb-0" placeholder="Write here" id="AboutProduct" name="AboutProduct">@Model.productMaster.AboutProduct </textarea>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- // -->
                <div class="row">
                    <div class="col-lg-12">
                        <h6>Details</h6>
                        <!-- // -->

                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label">Website <span style="color:#ed2323 ">*</span></label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="Paste URL here" name="Website" value="@Model.productMaster.Website" id="Website" />
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label">Languages Supported <span style="color:#ed2323 ">*</span></label>
                                <div class="ding">
                                    <select name="Languages" id="multiple" multiple>
                                        <option value="English">English</option>
                                        <option value="Romanian">Romanian</option>
                                        <option value="Bengali">Bengali</option>
                                        <option value="Spanish">Spanish</option>
                                        <option value="Greek">Greek</option>
                                        <option value="German">German</option>
                                        <option value="Hungarian">Hungarian</option>
                                        <option value="Ukrainian">Ukrainian</option>
                                        <option value="Chinese">Chinese </option>
                                        <option value="Korean">Korean</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-12 col-12">
                                <label class="software_label">Product Description <span style="color:#ed2323 ">*</span></label>
                                <textarea class="field01 field03 rounded-0 mb-0" placeholder="Write here" name="Description" id="Description">@Model.productMaster.Description</textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- // -->
                <div class="row">
                    <div class="col-lg-12">
                        <h6>Seller Details</h6>
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label"><img src="~/Content/Web/images/icon04.png" alt="" /> Seller <span style="color:#ed2323 ">*</span></label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="Seller" name="CompanyName" value="@Model.productMaster.CompanyName" id="CompanyName" />
                            </div>

                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label"><img src="~/Content/Web/images/email.png" alt="" /> Email <span style="color:#ed2323 ">*</span></label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="Email" value="@Model.productMaster.CompanyEmail" name="CompanyEmail" id="CompanyEmail" />
                            </div>

                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label"><img src="~/Content/Web/images/icon05.png" alt="" /> HQ Location <span style="color:#ed2323 ">*</span></label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="Enter addres here" name="HQLocation" value="@string.Join(", ", new[] { Model.productMaster.City, Model.productMaster.State, Model.productMaster.Country }.Where(s => !string.IsNullOrEmpty(s)))" id="HQLocation" />
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label"><img src="~/Content/Web/images/icon06.png" alt="" /> Company Website <span style="color:#ed2323 ">*</span></label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="" value="@Model.productMaster.CompanyWebsite" name="CompanyWebsite" id="CompanyWebsite" />
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label"><img src="~/Content/Web/images/icon07.png" alt="" /> Twitter </label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="Enter URL here" name="Twitter" value="@Model.productMaster.Twitter" id="Twitter" />
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label"><img src="~/Content/Web/images/icon08.png" alt="" /> Phone </label>
                                <div class="wrapper">
                                    <div class="search_box">
                                        <div class="dropdown">
                                            <div class="default_option">+92</div>
                                            <ul>
                                                <li>+91</li>
                                                <li>+95</li>
                                                <li>+96</li>
                                            </ul>
                                        </div>
                                        <div class="search_field">
                                            <input type="text" class="input field01" id="Phone" placeholder="" value="@Model.productMaster.Phone" name="Phone" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <label class="software_label"><img src="~/Content/Web/images/icon09.png" alt="" /> LinkedIn Page </label>
                                <input type="text" class="field01 field04 rounded-0" placeholder="Enter URL" value="@Model.productMaster.LinkedIn" name="LinkedIn" id="LinkedIn" />
                            </div>
                        </div>

                        <!-- // -->
                        @*<button type="button" class="submit01 save_btn">Save</button>*@
                    </div>
                </div>
                <!-- // -->
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-12">
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-12">
                                <h6>Videos </h6>
                                <!-- // -->
                                <label class="software_label">Upload Video <span style="color:#ed2323 ">*</span></label>
                                <div class="drop-zone" id="DivVideoUpld">
                                    <span class="drop-zone__prompt" id="Video01">
                                        <img src="~/Content/Web/images/video.png" alt="" /> <br />
                                        Upload Video
                                    </span>
                                    <input type="file" name="FileName[]" id="FileName" accept="video/mp4" class="drop-zone__input" multiple />

                                    @*<div id="videoPreviewContainer"></div>*@
                                </div>
                                <div class="video-parent" id="videoPreviewContainer">
                                    @{
                                        int videoCount = 0;
                                        int videoId = 0;
                                        foreach (Apparent.Model.Video video in Model.productMaster.Product_videosFile)
                                        {

                                            videoCount++;

                                            @*<video class="video-upload video-child" controls="true" id="videoPlayer_@videoCount" src="@video.Path"></video>
                                            <span id="videoRemove_@videoCount" onclick="removeVideo('videoPlayer_@videoCount',@videoCount)">Remove</span>*@


                                            <div class="image-preview video-upload" id="videoPlayerdiv_@videoCount">
                                                <video class="video-child img-responsive img-fluid picProper" controls="true" id="videoPlayer_@videoCount" src="@video.Path"></video> 
                                                 <span class="cancel-icon" onclick="removeVideo('videoPlayerdiv_@videoCount','videoPlayer_@videoCount')">&#10006;</span>
                                                        </div>
                                                        }
                                                        }

                                            </div>
                                        </div>

                        </div>
                        <!-- // -->
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-12">
                                <h6>Photos </h6>
                                <!-- // -->
                                <label class="software_label">Upload Photos <span style="color:#ed2323 ">*</span></label>

                                <div class="drop-zone" id="DivImageUpld">
                                    <span class="drop-zone__prompt">
                                        <img src="" alt="" /> <br />
                                        Upload Photos
                                    </span>
                                    <input type="file" name="ScreenshotFile[]" id="ScreenshotFile" accept="image/*" class="drop-zone__input" multiple />

                                </div>
                                <div @*class="video-parent"*@ id="imagePreviewContainer">
                                    @{
                                        int imageCount = 0;

                                        foreach (Apparent.Model.ProductImage img in Model.productMaster.Product_imagesFile)
                                        {

                                            imageCount++;

                                                                        <div class="image-preview video-upload" id="uploadedImagediv_@imageCount">
                                                                            <img class="video-child img-responsive img-fluid picProper" id="uploadedImage_@imageCount" src="@img.ImagesPath">
                                                                            <span class="cancel-icon" onclick="removeImage('uploadedImagediv_@imageCount','uploadedImage_@imageCount')">&#10006;</span>
                                                                        </div>

                                                @*<img class="video-upload video-child" id="uploadedImage_@imageCount" src="@img.ImagesPath">
                    <span id="imgRemove_@imageCount" onclick="removeImage('uploadedImage_@imageCount',@imageCount)">Remove</span>*@

                                                }
                                                }
                                            </div>
                                        </div>
                        </div>
                <input type="hidden" value="@Model.productMaster.Category" id="catlist" />
                <input type="hidden" value="@Model.productMaster.ProductId" id="product_id" />
                <button type="button" onclick="vaildation()" class="submit01 save_btn">Update</button>
            </form>
        </div>
    </div>
</section>
<!-- // footer chat box -->
<button class="open-button" onclick="openForm()"><img src="~/Content/Web/images/comment02.png" alt="" /></button>
<div class="chat-popup" id="myForm">
    <form class="form-container">
        <div class="chathead">
            <h3>Product Details Comments</h3>
            <button type="button" class="cancel" onclick="closeForm()"><img src="~/Content/Web/images/close.png" alt="" /></button>
        </div>
        <div class="chatbody product">
        </div>

        <div class="foot">
            <input type="hidden" name="product_comment" id="product_comment" />
            <input type="text" id="productchatbox" class="msg" placeholder="Type a message..." />
            <button type="button" onclick="productchatButtonClick();" class="cmnt_send"><img src="~/Content/Web/images/send.png" alt="" /></button>
        </div>
    </form>
</div>
<!-- // footer chat box -->

<div class="container">
    <!-- The Modal -->
    <div class="modal" id="successModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- Modal body -->
                <div class="modal-body pt_40">
                    <ul class="progressbar">
                        <li class="active">Product Details</li>
                        <li>Features</li>
                        <li>Pricing/Packages</li>
                    </ul>

                    <h4 class="modal-title text-center mt-4 mb-3">Success</h4>
                    <p class="text-center">Product details updated</p>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer pb_50">
                    <button type="button" onclick="featuresfun()" class="btn okBtn" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/slim-select/1.21.0/slimselect.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert-dev.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css">
<script>


    $(document).ready(function () {
        ($("#loder01").css("display", "block"));
        $("#loder01").hide()
        $(document).ajaxStart(function () {
            ($("#loder01").css("display", "block"));
        });

        $(document).ajaxStop(function () {
            $("#loder01").hide()
        });
    })


    var languages = [];
    var matchingvidArray = [];
    var matchingSrcArray = [];
    var uploadedImageCount=@imageCount
    var uploadedVideoCount = @videoCount;
    console.log(languages)

</script>
@{

    foreach (var items in @Model.productMaster.Lang)
    {
        <script>
            languages.push('@items')
        </script>
    }
}
<script>
    $(document).ready(function () {

        // Show the custom modal when the button is clicked
        $('#showModalButton').on('click', function () {

            $('#customModal').fadeIn();

        // Close the custom modal when the close button or the background is clicked
        // $('#closeModal, #customModal').on('click', function () {
        //     $('#customModal').fadeOut();
        // });

        // Prevent modal content from closing the modal when clicked
        $('#modalContent').on('click', function (e) {
            e.stopPropagation();
        });

       

    });
</script>

<script>
    $(document).ready(function () {

        $("select[name = 'Languages']").each(function () {

            var selectValue1 = $(this).val()
            if (languages.includes(selectValue1)) {
                $(this).prop('selected', 'selected');
            }


        });

        var allCategory = "@Model.productMaster.CategoryValue";

        var tempElement = document.createElement('div');
        tempElement.innerHTML = allCategory;

        // Get the decoded text content
        var decodedCategory = tempElement.textContent || tempElement.innerText;

        var allLanguage ="@Model.productMaster.LanguageValue";
        _categorySelect.set(decodedCategory.split(','));
        _languageSelect.set(allLanguage.split(','));


    })
</script>

<script>
    //comment listed in array
    var productcom = {};
    var productcomlist = [];
    console.log(productcomlist);
</script>
@{
    foreach (Apparent.Model.Product_Comment price_Comment in Model.productMaster.GetProduct_Comments)
    {
        <script>
            productcom = {
               comments:'@(price_Comment.Comment)',
               seller_id : '@(price_Comment.Seller_ID)',
               admin_id: '@(price_Comment.Admin_ID)',
               time: '@(price_Comment.Comment_Time)'
            }
            productcomlist.push(productcom);

        </script>
    }



}

<script>
    $(document).ready(function () {

        for (var i = 0; productcomlist.length > i; i++) {

            var product = productcomlist[i];
            console.log(product);

            if (product.admin_id != "") {

                var swel = document.createElement("div");
                swel.className = "in_avtar";
                swel.textContent = "A";
                var newincoming = document.createElement("div");
                newincoming.className = "incoming";
                var newBubble = document.createElement("div");
                newBubble.className = "bubble";
                var newP = document.createElement("p");
                newP.textContent = product.comments;
                // Append the new elements to the existing 'incoming' div
                newBubble.appendChild(newP);
                newincoming.appendChild(newBubble);
                document.querySelector(".product").appendChild(swel);
                document.querySelector(".product").appendChild(newincoming);
            }
            else {
                var avver = document.createElement("div");
                avver.className = "out_avtar";
                avver.textContent = "S";

                var newincoming = document.createElement("div");
                newincoming.className = "outgoing";
                var newBubble = document.createElement("div");
                newBubble.className = "bubble";
                var newP = document.createElement("p");
                newP.textContent = product.comments;
                // Append the new elements to the existing 'incoming' div
                newBubble.appendChild(newP);
                newincoming.appendChild(newBubble);
                document.querySelector(".product").appendChild(avver);
                document.querySelector(".product").appendChild(newincoming);
            }
        }





    })

    function productchatButtonClick() {
        pValues = [];
        // Create a new div element with the specified content
        var msg = $("#productchatbox").val();

        var avver = document.createElement("div");
        avver.className = "out_avtar";
        avver.textContent = "S";
        var newoutgoing = document.createElement("div");
        newoutgoing.className = "outgoing otgproduct";
        var newBubble = document.createElement("div");
        newBubble.className = "bubble";

        var newP = document.createElement("p");
        newP.textContent = msg;

        // Append the new elements to the existing 'incoming' div
        newBubble.appendChild(newP);
        newoutgoing.appendChild(newBubble);
        document.querySelector(".product").appendChild(avver);
        document.querySelector(".product").appendChild(newoutgoing);

        $(".otgproduct p").each(function () {
            pValues.push($(this).text());
        });

        var comtext = pValues.join("~");

        $("#productchatbox").val("");
        $("#product_comment").val(comtext);

        console.log(comtext);
    }
</script>



<script>
    var imageFileArray = [];
    var videoFileArray = [];
    $(document).ready(function () {
        $('#FileName').change(function () {
            var files = $(this)[0].files;
            // Get the selected files
            var videos = this.files;

            // Check if any files were selected
            if (videos.length === 0) {
                return;
            }

            for (var i = 0; i < videos.length; i++) {
                var file = videos[i];

                // Check file size (max 500KB)
                if (file.size > 800 * 1024) {
                    alert('File ' + file.name + ' size should be less than 800KB.');
                    // Clear the input field for the specific file
                    $('#videoInput').val('');
                    return;
                }

                // Check if the file type is a video (you can specify allowed video formats)
                if (!file.type.includes("video")) {
                    alert('Please select a valid video file.');
                    // Clear the input field for the specific file
                    $('#videoInput').val('');
                    return;
                }
            }

            for (var i = 0; i < files.length; i++) {
                uploadedVideoCount++;
                var file = files[i];
                //var videoPlayer = document.createElement('video');
                //videoPlayer.className = 'video-upload video-child';
                //videoPlayer.setAttribute('controls', true);

                var videoPlayer = $('<div class="image-preview video-upload" id="videoPlayerdiv_' + uploadedVideoCount +'">')
                    .append($('<video class="video-child img-responsive img-fluid picProper" controls="true" id="videoPlayer_' + uploadedVideoCount +'" >').attr('src', URL.createObjectURL(file)))
                    .append($('<span class="cancel-icon" onclick="removeVideo(`videoPlayerdiv_' + uploadedVideoCount + '`,' +'`videoPlayer_' + uploadedVideoCount +'`)">').html('&#10006;'));
                // Set unique IDs for the video player, canvas, and preview image
               /* videoPlayer.id = 'videoPlayer_' + uploadedVideoCount;*/


                // Append the video player, canvas, and preview image to the container
                $('#videoPreviewContainer').append(videoPlayer);
                videoPlayer.src = URL.createObjectURL(file);
                var ext = file.name.split('.')[1];
                var newfileName = 'videoPlayer_' + uploadedVideoCount + '.' + ext;
                var newFile = new File([file], newfileName);
               /* let videoRemove = `<span id="videoRemove_` + uploadedVideoCount + `" onclick="removeVideo('videoPlayer_` + uploadedVideoCount + `',` + uploadedVideoCount + `)">Remove</span>`;*/
                /*$('#videoPreviewContainer').append(videoRemove);*/
                // Load the selected video into the video player

                videoFileArray.push(newFile);

            }
        });

        $('#ScreenshotFile').change(function () {
            var files = $(this)[0].files;

            var images = this.files;
            // Check if any files were selected
            if (images.length === 0) {
                return;
            }

            for (var i = 0; i < images.length; i++) {
                var file = images[i];

                // Check file size (max 100KB)
                if (file.size > 100 * 1024) {
                    alert('File ' + file.name + ' size should be less than 100KB.');
                    // Clear the input field for the specific file
                    $('#imageInput').val('');
                    return;
                }

                // Create an Image object to check image dimensions
                var img = new Image();

                img.onload = function () {
                    // Check image dimensions
                    if (this.width <= 600 && this.height <= 600) {

                        var previewContainer = $('#imagePreviewContainer');
                        //previewContainer.empty();

                        for (var i = 0; i < files.length; i++) {
                            let file = files[i];
                            var reader = new FileReader();

                            reader.onload = function (e) {
                                uploadedImageCount++;
                                var imageSrc = e.target.result;

                                var base64Image = imageSrc.split(",")[1]; // Remove the "data:image/jpeg;base64," prefix
                                // Convert base64 data to a blob
                                var blob = dataURItoBlob(base64Image);
                                var file = new File([blob], "uploadedImage_" + uploadedImageCount + ".jpg");

                                // Set the File object as the value of the file input
                                imageFileArray.push(file);
                                console.log(imageFileArray);
                               /* var previewImage = $('<img class="video-upload video-child" id="uploadedImage_' + uploadedImageCount + '">').attr('src', imageSrc);*/
                                var previewImage = $('<div class="image-preview video-upload" id="uploadedImagediv_' + uploadedImageCount + '">')
                                    .append($('<img class="video-child img-responsive img-fluid picProper">').attr('src', imageSrc))
                                    .append($('<span class="cancel-icon" onclick="removeImage(`uploadedImagediv_' + uploadedImageCount + '`,`' +'uploadedImage_ '+ uploadedImageCount +'`)">').html('&#10006;')); // &#10006; is the cancel icon (X)

                                previewContainer.append(previewImage);

                                  'uploadedImagediv_@imageCount','uploadedImage_@imageCount'

                                //let imgRemove = `<span id="imgRemove_` + uploadedImageCount + `" onclick="removeImage('uploadedImage_` + uploadedImageCount + `',` + uploadedImageCount + `)">Remove</span>`;
                                //previewContainer.append(imgRemove);



                            };

                            reader.readAsDataURL(file);
                        }
                        //$('#DivImageUpld').hide();
                    } else {
                        alert('Image ' + file.name + ' dimensions should be 600x600 pixels');
                        // Clear the input field for the specific file
                        $('#imageInput').val('');
                        return;
                    }
                };
                img.src = URL.createObjectURL(file);
            };


        });

        function dataURItoBlob(dataURI) {
            var byteString = atob(dataURI);
            var ab = new ArrayBuffer(byteString.length);
            var ia = new Uint8Array(ab);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: "image/jpeg" });
        }

        $('#ProductImage').change(function () {

            var file = $(this)[0].files[0];

            if (file) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var imageSrc = e.target.result;
                    $('#IdImg').attr('src', imageSrc);
                };

                reader.readAsDataURL(file);
            } else {
                // Handle the case when no file is selected
                $('#IdImg').removeAttr('src');
            }
        });
    });


</script>


<script>

    var pro_id;
    function vaildation() {

        var selectedValues01 = [];
        var selectedcategory = [];
        $("#multiple :selected").each(function () {
            selectedValues01.push($(this).val());
        });

        $("#Category :selected").each(function () {
            selectedcategory.push($(this).val());
        });
        var languages = selectedValues01.join(",");
        var Category = selectedcategory.join(",");
        var AboutProduct = $("#AboutProduct").val();
        var ProductName = $("#ProductName").val();
        var Category = $('#Category').find('option:selected').text()
        var Website = $("#Website").val();
        var Description = $("#Description").val();
        var CompanyName = $("#CompanyName").val();
        var CompanyEmail = $("#CompanyEmail").val();
        var HQLocation = $("#HQLocation").val();
        var CompanyWebsite = $("#CompanyWebsite").val();
        var Twitter = $("#Twitter").val();
        var Phone = $("#Phone").val();
        var LinkedIn = $("#LinkedIn").val();
        var Notes = $("#product_comment").val();
        var ProductImage = $('#ProductImage')[0].files[0];

        if (ProductName == "") {
            swal({
                title: "Information!",
                text: "Enter product name",
                type: "info"
            });
            return;
        }
        else if (ProductImage == "") {
            swal({
                title: "Information!",
                text: "Please upload product logo",
                type: "info"
            });
            return;
        }

        else if (languages == "") {
            swal({
                title: "Information!",
                text: "Please select product languages",
                type: "info"
            });
            return;
        }


        else if (Category == "") {
            swal({
                title: "Information!",
                text: "Please select product category",
                type: "info"
            });
            return;

        }
        else if (AboutProduct == "") {
            swal({
                title: "Information!",
                text: " Please enter what is your software?",
                type: "info"
            });
            return;
        }
        else if (Website == "") {
            swal({
                title: "Information!",
                text: "Please enter product website ",
                type: "info"
            });
            return;

        }
        else if (Website == "") {
            swal({
                title: "Information!",
                text: " Please enter product website ",
                type: "info"
            });
            return;

        }
        else if (Description == "") {
            swal({
                title: "Information!",
                text: " Please write product description ",
                type: "info"
            });
            return;

        }
        else if (CompanyName == "") {
            swal({
                title: "Information!",
                text: "Please enter company name ",
                type: "info"
            });
            return;

        }
        else if (CompanyEmail == "") {
            swal({
                title: "Information!",
                text: "Please enter company email ",
                type: "info"
            });
            return;

        }
        else if (HQLocation == "") {
            swal({
                title: "Information!",
                text: "Please enter company HQ location ",
                type: "info"
            });
            return;

        }
        else if (CompanyWebsite == "") {
            swal({
                title: "Information!",
                text: "Please Enter Company  Website",
                type: "info"
            });
            return;

        }
            GetAllBlobImageAddress();
            GetAllBlobVideoAddress();
            var formData = new FormData();
            formData.append('ProductName', ProductName);
            formData.append('Category', Category);
            formData.append('Website', Website);
            formData.append('AboutProduct', AboutProduct);
            formData.append('Description', Description);
            formData.append('CompanyName', CompanyName);
            formData.append('CompanyEmail', CompanyEmail);
            formData.append('HQLocation', HQLocation);
            formData.append('CompanyWebsite', CompanyWebsite);
            formData.append('Twitter', Twitter);
            formData.append('Phone', Phone);
            formData.append('LinkedIn', LinkedIn);
            formData.append('Notes', Notes);
            formData.append('id', $("#product_id").val());
            for (var k = 0; videoFileArray.length > k; k++) {
                formData.append('FileName' + k, videoFileArray[k]);
            }
            for (var k = 0; imageFileArray.length > k; k++) {
                formData.append('ScreenshotFile' + k, imageFileArray[k]);
            }
            formData.append('SupportLanguages', languages);
            formData.append('ProductImage', ProductImage);

            for (var i = 0; i < matchingSrcArray.length; i++) {
                formData.append('AllBlobImgAddress', matchingSrcArray[i]);
            }
            for (var i = 0; i < matchingvidArray.length; i++) {
                formData.append('AllBlobVideoAddress', matchingvidArray[i]);
            }
            ProductSubmit(formData);
    }
    function ProductSubmit(formData) {
        $.ajax({
            url: '/Product/updateProduct',
            type: 'POST',
            data: formData,
            cache: false,
            contentType: false,
            enctype: 'multipart/form-data',
            processData: false,
            success: function (data) {

                if (data.respons_result == "success") {
                    pro_id = data.ProductId;

                    $('#successModal').modal('toggle')
                }
                else {
                    swal({
                        title: "Error",
                        text: "Something worng",
                        type: "error"
                    });
                }

            }
        });


    }

    function featuresfun() {
        $('#successModal').modal('hide');
        var url = "/Product/update_features?ProductId=" + pro_id;
        window.location = url;

    }
</script>

<script>
    function openForm() {
        document.getElementById("myForm").style.display = "block";
    }

    function closeForm() {
        document.getElementById("myForm").style.display = "none";
    }
</script>

<script>
        function removeImage(imagedivId, imageId) {
            
            var imageToRemove = document.getElementById(imagedivId);
            debugger;
        if (imageToRemove) {
            imageToRemove.parentNode.removeChild(imageToRemove);

        }
        //var spanToRemove = document.getElementById('imgRemove_' + count);
        //if (spanToRemove) {
        //    spanToRemove.parentNode.removeChild(spanToRemove);
        //}
        // Find the index of the Blob with the file name "abc.jpg"
        const indexToDelete = imageFileArray.findIndex(blob => blob.name.split('.')[0] === imageId);

        // Check if the Blob with the specified file name was found
        if (indexToDelete !== -1) {
            // Remove the Blob at the found index
            imageFileArray.splice(indexToDelete, 1);
        }
        uploadedImageCount--;
        console.log(imageFileArray);
    }
        function removeVideo(videoDivId, videoId) {

            debugger;
            var videoToRemove = document.getElementById(videoDivId);
        if (videoToRemove) {
            videoToRemove.parentNode.removeChild(videoToRemove);

        }
        //var spanToRemove = document.getElementById('videoRemove_' + count).remove();
        //if (spanToRemove) {
        //    spanToRemove.parentNode.removeChild(spanToRemove);
        //}

        // Find the index of the Blob with the file name "abc.jpg"
        const indexToDelete = videoFileArray.findIndex(blob => blob.name.split('.')[0] === videoId);

        // Check if the Blob with the specified file name was found
        if (indexToDelete !== -1) {
            // Remove the Blob at the found index
            videoFileArray.splice(indexToDelete, 1);
        }
        uploadedVideoCount--;
        console.log(videoFileArray);
    }

    function GetAllBlobImageAddress() {
        // Initialize an array to store matching src values
       

        // Iterate through each img element within the imagePreviewContainer
        $('#imagePreviewContainer').find('img').each(function () {
            // Get the src attribute value
            var srcValue = $(this).attr('src');

            // Check if the src value contains the specified string
            if (srcValue.includes('apparent.blob.core.windows.net')) {
                // If it does, push the src value to the array
                matchingSrcArray.push(srcValue);
            }
        });

        // Output the array of matching src values
        console.log(matchingSrcArray);
        return matchingSrcArray;
    }
    function GetAllBlobVideoAddress() {
        // Initialize an array to store matching src values
       
   
        // Iterate through each img element within the imagePreviewContainer
        $('#videoPreviewContainer').find('video').each(function () {
            // Get the src attribute value
            var srcValue = $(this).attr('src');
           
            // Check if the src value contains the specified string
            if (srcValue.includes('apparent.blob.core.windows.net')) {
                // If it does, push the src value to the array
                matchingvidArray.push(srcValue);
            }
        });
        // Output the array of matching src values
        console.log(matchingvidArray);
        return matchingvidArray;
    }
</script>
<script>
    var imageFile;
    const imageInput = document.getElementById('ProductImage');
    const croppedImage = document.getElementById('croppedImage');
    let cropper;
    let fileTarget;
    // Initialize Cropper.js when an image is selected
    imageInput.addEventListener('change', function (e) {
        fileTarget = e.target;
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                if (cropper) {
                    cropper.destroy();
                }
                croppedImage.src = e.target.result;
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1, // You can set the aspect ratio you need
                });
            };
            reader.readAsDataURL(file);
        }
        $('#customModal').fadeIn();
    });
    $('#cropImage').click(function () {
        const croppedCanvas = cropper.getCroppedCanvas();
        const imageData = croppedCanvas.toDataURL('image/jpeg');
        console.log(fileTarget);
        $('#IdImg').attr('src', imageData);
        $('#customModal').fadeOut();
        $('#ProductImage').val("");

        var base64Image = imageData.split(",")[1]; // Remove the "data:image/jpeg;base64," prefix

        // Convert base64 data to a blob
        var blob = dataURItoBlob(base64Image);
        var file = new File([blob], Date.now() + ".jpg");

        // Set the File object as the value of the file input
        imageFile = file;
    });

    $("#cropImagehide").click(function () {
        $('#customModal').fadeOut();
    });



    //function dataURItoBlob(dataURI) {
    //    var byteString = atob(dataURI);
    //    var ab = new ArrayBuffer(byteString.length);
    //    var ia = new Uint8Array(ab);
    //    for (var i = 0; i < byteString.length; i++) {
    //        ia[i] = byteString.charCodeAt(i);
    //    }
    //    return new Blob([ab], { type: "image/jpeg" });
    //}
</script>
